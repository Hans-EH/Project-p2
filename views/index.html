{% extends "base.html" %} {% block content %}
<script></script>

<h1>Homepage</h1>
<div class="row mb-3">
  <div class="col-3">
    <div class="card">
      <div class="card-body">This is some text within a card body.</div>
    </div>
  </div>
  <div class="col-3">
    <div class="card">
      <div class="card-body">This is some text within a card body.</div>
    </div>
  </div>
  <div class="col-3">
    <div class="card">
      <div class="card-body">This is some text within a card body.</div>
    </div>
  </div>
  <div class="col-3">
    <div class="card">
      <div class="card-body">This is some text within a card body.</div>
    </div>
  </div>
</div>

<div class="row mb-3">
  <div class="col-12">
    <div class="card">
      <div class="card-body">Graph</div>

      <button class="btn btn-primary" onclick="energiDataEMI()">Hent</button>
      <canvas id="myChart"></canvas>
    </div>
  </div>
</div>

<script>
  async function energiDataEMI() {
    try {
      const URI =
        'https://www.energidataservice.dk/proxy/api/datastore_search_sql?sql=SELECT"Minutes5UTC", "Minutes5DK", "PriceArea", "CO2Emission" FROM "co2emis" ORDER BY "Minutes5UTC" DESC LIMIT 100';
      let data = await fetch(URI).then((response) => response.json());

      // Test logging;
      console.log(data);

      // Arrays for labels and values
      let dataLabels = [];
      let dataValues = [];

      // Length of reponse
      let rec_length = data.result.records.length;

      // Iterate over reponse results
      for (let i = 0; i < rec_length; i++) {
        // Push labels and values to

        if (data.result.records[i].PriceArea == "DK1") {
          dataValues.push(data.result.records[i].CO2Emission);
          dataLabels.push(data.result.records[i].Minutes5DK);
        }
      }

      dataLabels = dataLabels.reverse();
      dataValues = dataValues.reverse();

      var ctx = document.getElementById("myChart").getContext("2d");
      var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: "line",

        // The data for our dataset
        data: {
          labels: dataLabels.slice(0, 20),
          datasets: [
            {
              label: "CO2 Emission (5min)",
              borderColor: "rgb(255, 99, 132)",
              data: dataValues.slice(0, 20),
            },
          ],
        },

        // Configuration options go here
        options: {},
      });

      // return labels and values as object
      return {
        dataValues,
        dataLabels,
      };
    } catch {
      console.log("Forhelvede....");
    }
  }

  let data = energiDataEMI();
</script>

{% endblock %}
